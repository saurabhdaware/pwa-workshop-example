<!DOCTYPE html>
<html lang="en">
<head>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="manifest" href="./app.webmanifest">
  <meta name="theme-color" content="#09f">
  <title>PWA Example</title>
</head>
<body>
  <h1>PWA Workshop Example</h1>
  <p class="text">Hey there!</p>
  <button style="display: none" class="add-to-homescreen-button">Add to Homescreen</button>

  <button class="send-data-button">Send data to server</button>
  <script>
    // registration of service worker
    if('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
        try {
          navigator.serviceWorker.register('./service-worker.js');
          console.log('service worker registration successful');
        } catch (err) {
          console.log(err);
        }
      })
    };



    let deferredPromptEvent;
    const addToHomescreenButtonEl = document.querySelector('button.add-to-homescreen-button');

    // Add to homescreen button logic
    window.addEventListener('beforeinstallprompt', (e) => {
      e.preventDefault(); // prevents the default banner
      deferredPromptEvent = e; // store that event
      addToHomescreenButtonEl.style.display = 'block'; // make our add to homescreen button visible

      // 
      addToHomescreenButtonEl.addEventListener('click', (e) => {
        // hide our user interface that shows our A2HS button
        addToHomescreenButtonEl.style.display = 'none';
        // Show the prompt
        deferredPromptEvent.prompt();
        // Wait for the user to respond to the prompt
        deferredPromptEvent.userChoice.then((choiceResult) => {
          if (choiceResult.outcome === 'accepted') {
            console.log('User accepted the A2HS prompt');
          } else {
            console.log('User dismissed the A2HS prompt');
          }
          deferredPromptEvent = null;
        });
      });
    });





    // BACKGROUND SYNC
    document.querySelector('button.send-data-button').addEventListener('click', () => {
      navigator.serviceWorker.ready.then(function(swRegistration) {
        return swRegistration.sync.register('pwa-workshop-sync');
      });
    })
  </script>
  <script src="./app.js"></script>
</body>
</html>